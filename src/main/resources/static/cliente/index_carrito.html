<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carrito de Compras - Ferreter√≠a Pfeifer</title>
    <link rel="stylesheet" href="styles_carrito.css">

</head>
<body>
    <header class="header">
        <a href="index.html" class="logo-link">
            <img src="https://placehold.co/170x50/F7A233/2c3e50?text=FERRETERIA+PFEIFER&font=roboto" alt="Ferreter√≠a Pfeifer Logo" class="logo">
        </a>
        <nav class="menu">
            <ul>
                <li><a href="index.html">Inicio</a></li>
                <li><a href="index_herramientas.html">Herramientas</a></li>
                <li><a href="index_seguridad.html">Seguridad</a></li>
                <li><a href="index_plomeria.html">Plomer√≠a</a></li>
                <li><a href="index_electricidad.html">Electricidad</a></li>
                <li><a href="index_jardin.html">Jard√≠n</a></li>
                <li><a href="index_contacto.html">Contacto</a></li>
            </ul>
        </nav>
        <div class="header-icons">
             <a href="index_usuario.html" aria-label="Mi Cuenta">üë§</a>
             <a href="index_carrito.html" aria-label="Carrito de compras" class="cart-icon-link active"> üõí
                <span class="cart-item-count-badge" style="display: none;">0</span>
             </a>
        </div>
    </header>

    <main class="container">
        <h1 class="page-title">Carrito de Compras</h1>

        <section class="cart-section">
            <div id="cartItemsContainer">
                </div>

            <div id="emptyCartMessage" class="empty-cart-message" style="display: none;">
                <p>Tu carrito de compras est√° vac√≠o.</p>
                <a href="index.html" class="btn-primary mt-2">Seguir Comprando</a>
            </div>

            <div class="cart-summary" id="cartSummaryContainer" style="display: none;">
                <h3>Resumen de Compra</h3>
                <div class="summary-row">
                    <span>Subtotal Productos:</span>
                    <span id="cartSubtotal">$0</span>
                </div>
                <div class="summary-row">
                    <span>Costo de Env√≠o:</span>
                    <span id="shippingCost">A calcular</span>
                </div>
                <div class="summary-row total">
                    <span>Total a Pagar:</span>
                    <span id="cartTotal">$0</span>
                </div>
                <div class="cart-actions">
                    <button type="button" id="btnCheckout" class="btn-primary btn-checkout">Proceder al Pago</button>
                </div>
            </div>
        </section>
    </main>

    <footer class="footer">
        <p>¬© <span id="currentYear"></span> Ferreter√≠a Pfeifer. Todos los derechos reservados.</p>
        <div class="social-links">
            <a href="#" aria-label="Facebook" title="Facebook">f</a>
            <a href="#" aria-label="Instagram" title="Instagram">i</a>
            <a href="#" aria-label="WhatsApp" title="WhatsApp">w</a>
        </div>
    </footer>

    <script src="scripts_carrito.js"></script>
    <script>
        // L√≥gica espec√≠fica para la p√°gina del carrito
        document.addEventListener('DOMContentLoaded', () => {
            const cartItemsContainerEl = document.getElementById('cartItemsContainer');
            const cartSubtotalEl = document.getElementById('cartSubtotal');
            const cartTotalEl = document.getElementById('cartTotal');
            const emptyCartMessageEl = document.getElementById('emptyCartMessage');
            const cartSummaryContainerEl = document.getElementById('cartSummaryContainer');
            const shippingCostEl = document.getElementById('shippingCost'); // Para el costo de env√≠o

            function formatCurrency(amount) {
                return new Intl.NumberFormat('es-CL', { style: 'currency', currency: 'CLP' }).format(amount);
            }

            function renderizarItemsCarrito() {
                const carrito = obtenerItemsCarrito();
                cartItemsContainerEl.innerHTML = ''; // Limpiar items existentes

                if (carrito.length === 0) {
                    emptyCartMessageEl.style.display = 'block';
                    cartSummaryContainerEl.style.display = 'none';
                } else {
                    emptyCartMessageEl.style.display = 'none';
                    cartSummaryContainerEl.style.display = 'block';
                    carrito.forEach(item => {
                        const itemHTML = `
                            <div class="cart-item" data-id="${item.id}" data-price="${item.precio}">
                                <div class="cart-item-image">
                                    <img src="${item.imagen || 'https://placehold.co/100x100?text=No+Img'}" alt="${item.nombre}">
                                </div>
                                <div class="cart-item-details">
                                    <h4>${item.nombre}</h4>
                                    <p class="item-price">Precio Unitario: ${formatCurrency(item.precio)}</p>
                                </div>
                                <div class="cart-item-quantity">
                                    <button class="quantity-decrease" aria-label="Disminuir cantidad">-</button>
                                    <input type="number" value="${item.cantidad}" min="1" max="99" class="item-quantity" aria-label="Cantidad">
                                    <button class="quantity-increase" aria-label="Aumentar cantidad">+</button>
                                </div>
                                <div class="cart-item-subtotal" aria-label="Subtotal del item">${formatCurrency(item.precio * item.cantidad)}</div>
                                <div class="cart-item-remove">
                                    <button class="remove-item" aria-label="Eliminar item">üóëÔ∏è</button>
                                </div>
                            </div>
                        `;
                        cartItemsContainerEl.insertAdjacentHTML('beforeend', itemHTML);
                    });
                }
                actualizarResumenCarrito();
                actualizarContadorCarritoIcono(); // Asegura que el √≠cono del header tambi√©n se actualice
            }

            function actualizarResumenCarrito() {
                const carrito = obtenerItemsCarrito();
                let subtotal = 0;
                carrito.forEach(item => {
                    subtotal += item.precio * item.cantidad;
                });

                cartSubtotalEl.textContent = formatCurrency(subtotal);
                // L√≥gica de env√≠o (ejemplo b√°sico, podr√≠a ser m√°s complejo)
                const costoEnvio = subtotal > 50000 || subtotal === 0 ? 0 : 3500; // Env√≠o gratis sobre $50.000
                shippingCostEl.textContent = costoEnvio === 0 && subtotal > 0 ? "Gratis" : (subtotal === 0 ? "N/A" : formatCurrency(costoEnvio));
                
                cartTotalEl.textContent = formatCurrency(subtotal + (subtotal === 0 ? 0 : costoEnvio) );

                if (carrito.length === 0) {
                    cartSummaryContainerEl.style.display = 'none';
                } else {
                    cartSummaryContainerEl.style.display = 'block';
                }
            }

            cartItemsContainerEl.addEventListener('click', (event) => {
                const target = event.target;
                const cartItemEl = target.closest('.cart-item');
                if (!cartItemEl) return;

                const productoId = cartItemEl.dataset.id;
                const quantityInput = cartItemEl.querySelector('.item-quantity');
                let cantidad = parseInt(quantityInput.value);

                if (target.classList.contains('quantity-increase')) {
                    if (cantidad < parseInt(quantityInput.max)) {
                        actualizarCantidadCarrito(productoId, cantidad + 1);
                        renderizarItemsCarrito(); // Re-renderizar para actualizar todo
                    }
                } else if (target.classList.contains('quantity-decrease')) {
                    if (cantidad > parseInt(quantityInput.min)) {
                        actualizarCantidadCarrito(productoId, cantidad - 1);
                    } else { // Si la cantidad llega a 0 al disminuir, eliminarlo
                        if (confirm('¬øEst√°s seguro de que quieres eliminar este producto del carrito?')) {
                            eliminarDelCarrito(productoId);
                        }
                    }
                    renderizarItemsCarrito();
                } else if (target.classList.contains('remove-item')) {
                    if (confirm('¬øEst√°s seguro de que quieres eliminar este producto del carrito?')) {
                        eliminarDelCarrito(productoId);
                        renderizarItemsCarrito();
                    }
                }
            });

            cartItemsContainerEl.addEventListener('change', (event) => {
                const target = event.target;
                if (target.classList.contains('item-quantity')) {
                    const cartItemEl = target.closest('.cart-item');
                    const productoId = cartItemEl.dataset.id;
                    let nuevaCantidad = parseInt(target.value);
                    const min = parseInt(target.min);
                    const max = parseInt(target.max);

                    if (isNaN(nuevaCantidad) || nuevaCantidad < min) {
                        nuevaCantidad = min;
                        target.value = nuevaCantidad; // Corregir el input
                    } else if (nuevaCantidad > max) {
                        nuevaCantidad = max;
                        target.value = nuevaCantidad; // Corregir el input
                    }
                    actualizarCantidadCarrito(productoId, nuevaCantidad);
                    renderizarItemsCarrito(); // Re-renderizar para actualizar subtotal del item
                }
            });

            const btnCheckout = document.getElementById('btnCheckout');
            if (btnCheckout) {
                btnCheckout.addEventListener('click', () => {
                    const carrito = obtenerItemsCarrito();
                    if (carrito.length === 0) {
                        alert('Tu carrito est√° vac√≠o. A√±ade productos antes de proceder al pago.');
                        return;
                    }
                    alert('Procediendo al pago (simulaci√≥n). En una aplicaci√≥n real, se redirigir√≠a a una pasarela de pago o p√°gina de checkout.');
                    // Ejemplo: window.location.href = 'pasarela-pago.html';
                });
            }

            // Renderizar el carrito al cargar la p√°gina
            renderizarItemsCarrito();
            // Actualizar a√±o en footer
            document.getElementById('currentYear').textContent = new Date().getFullYear();
        });
    </script>
</body>
</html>
